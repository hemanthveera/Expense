<?xml version="1.0" encoding="UTF-8"?><database>
    <element label="Expense Summary" max_length="40" name="x_218245_expense_expense_summary" type="collection">
        <element calculation="(function calculatedFieldValue(current) {&#13;&#10;&#9;&#13;&#10;&#9;//declare variables&#13;&#10;&#9;var dailyRemainingBudget=0;&#13;&#10;&#9;&#13;&#10;&#9;//Calculate remaining days in the month&#13;&#10;&#9;var nowDate=new GlideDateTime();&#13;&#10;&#9;//First get total days in current month&#13;&#10;&#9;var totalDays=nowDate.getDaysInMonthLocalTime();&#13;&#10;&#9;&#13;&#10;&#9;//Get current day of the month&#13;&#10;&#9;var curDay=nowDate.getDayOfMonthLocalTime();&#13;&#10;&#9;&#13;&#10;&#9;//Calculate remaining days in current month&#13;&#10;&#9;var remainingDays=totalDays-(curDay-1); //-1 is because we want to include current day aswell&#13;&#10;&#9;&#13;&#10;&#9;&#13;&#10;&#9;&#13;&#10;&#9;&#13;&#10;&#9;var v_ga = new GlideRecord('x_218245_expense_expense');&#13;&#10;&#9;v_ga.addEncodedQuery(&quot;u_expense_dateONToday@javascript:gs.beginningOfToday()@javascript:gs.endOfToday()&quot;);&#13;&#10;&#9;v_ga.query();&#13;&#10;&#9;var todaySpent=0;&#13;&#10;&#9;var rowCount=v_ga.getRowCount();&#13;&#10;&#9;while(v_ga.next()){&#13;&#10;&#9;&#9;todaySpent=todaySpent+v_ga.u_expense_cost;&#13;&#10;&#9;}&#13;&#10;&#9;&#13;&#10;&#9;var expensesTillYesterday=0;&#13;&#10;&#9;if(current.u_expense_spent&lt;todaySpent){&#13;&#10;&#9;&#9;expensesTillYesterday=0; //This scenario should never occur, it's an extra check&#13;&#10;&#9;}&#13;&#10;&#9;else{&#13;&#10;&#9;&#9;expensesTillYesterday=(current.u_expense_spent-todaySpent);&#13;&#10;&#9;}&#13;&#10;&#9;dailyRemainingBudget=((current.u_expense_monthly_limit-expensesTillYesterday)/remainingDays)-todaySpent;&#13;&#10;&#9;&#13;&#10;&#9;&#13;&#10;&#9;return dailyRemainingBudget;  // return the calculated value&#13;&#10;&#13;&#10;})(current);" label="Daily Remaining Budget" max_length="40" name="u_daily_remaining_budget" read_only="true" type="float" virtual="true"/>
        <element default="50000" label="Monthly Limit" max_length="40" name="u_expense_monthly_limit" type="float"/>
        <element label="Monthly Savings" max_length="40" name="u_expense_monthly_savings" read_only="true" type="float"/>
        <element label="Expense Month and Year" max_length="40" name="u_expense_month_year" type="glide_date"/>
        <element default="60000" label="Salary" max_length="40" name="u_expense_salary" type="float"/>
        <element default="0" label="Spent" max_length="40" name="u_expense_spent" read_only="true" type="float"/>
        <element calculation="(function calculatedFieldValue(current) {&#13;&#10;&#13;&#10;&#9;&#13;&#10;&#9;//declare variables&#13;&#10;&#9;var dailyRemainingBudget=0;&#13;&#10;&#9;&#13;&#10;&#9;//Calculate remaining days in the month&#13;&#10;&#9;var nowDate=new GlideDateTime();&#13;&#10;&#9;//First get total days in current month&#13;&#10;&#9;var totalDays=nowDate.getDaysInMonthLocalTime();&#13;&#10;&#9;&#13;&#10;&#9;//Get current day of the month&#13;&#10;&#9;var curDay=nowDate.getDayOfMonthLocalTime();&#13;&#10;&#9;&#13;&#10;&#9;//Calculate remaining days in current month&#13;&#10;&#9;var remainingDays=totalDays-(curDay-1); //-1 is because we want to include current day aswell&#13;&#10;&#9;&#13;&#10;&#9;var todayTotal=0;&#13;&#10;&#9;var v_ga = new GlideRecord('x_218245_expense_expense');&#13;&#10;&#9;v_ga.addEncodedQuery(&quot;u_expense_dateONToday@javascript:gs.beginningOfToday()@javascript:gs.endOfToday()&quot;);&#13;&#10;&#9;v_ga.query();&#13;&#10;&#9;//var rowCount=v_ga.getRowCount();&#13;&#10;&#9;while(v_ga.next()){&#13;&#10;&#9;&#9;todayTotal=todayTotal+v_ga.u_expense_cost;&#13;&#10;&#9;}&#13;&#10;&#9;&#13;&#10;&#9;if((current.u_monthly_remaining_budget==0)||(todayTotal==0)){&#13;&#10;&#9;&#9;dailyRemainingBudget=(current.u_expense_monthly_limit-current.u_expense_spent)/remainingDays;&#13;&#10;&#9;}&#13;&#10;&#9;&#13;&#10;&#9;return dailyRemainingBudget;&#13;&#10;&#13;&#10;})(current);" default="0" label="Monthly Remaining Budget" max_length="40" name="u_monthly_remaining_budget" read_only="true" type="float"/>
        <element calculation="(function calculatedFieldValue(current) {&#10;&#10;&#9;var gdt= new GlideDate();&#10;&#9;gdt.setValue(current.u_expense_month_year);&#10;&#9;return gdt.getByFormat(&quot;MMM-YYYY&quot;); &#10;&#10;})(current);" display="true" label="Month &amp; Year" max_length="100" name="u_month_year" read_only="true" type="string" virtual="true"/>
    </element>
</database>
